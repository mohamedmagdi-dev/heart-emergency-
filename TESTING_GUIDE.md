# دليل اختبار تطبيق Heart Emergency

## نظرة عامة

هذا الدليل يشرح كيفية اختبار التطبيق والتأكد من أن جميع الوظائف تعمل بشكل صحيح.

## الاختبارات التلقائية

### تشغيل الاختبارات

```bash
# تشغيل جميع الاختبارات
flutter test

# تشغيل اختبارات محددة
flutter test test/unit/user_model_test.dart
flutter test test/unit/request_model_test.dart
flutter test test/unit/distance_calculation_test.dart
```

### الاختبارات المتوفرة

1. **اختبارات نموذج المستخدم** (`test/unit/user_model_test.dart`)
   - إنشاء نماذج المستخدمين (مريض، طبيب، أدمن)
   - تحويل البيانات من وإلى Map
   - نسخ النماذج مع تحديث الحقول
   - اختبار تحويل العملات

2. **اختبارات نموذج الطلبات** (`test/unit/request_model_test.dart`)
   - إنشاء طلبات الطوارئ
   - تحديث حالة الطلبات
   - تحويل البيانات من وإلى Map
   - اختبار حالات الطلبات المختلفة

3. **اختبارات حساب المسافة** (`test/unit/distance_calculation_test.dart`)
   - حساب المسافة بين النقاط الجغرافية
   - اختبار دقة حساب المسافة
   - التعامل مع الإحداثيات السالبة

## الاختبار اليدوي

### 1. اختبار تدفق المريض (Patient Flow)

#### التسجيل والدخول
1. افتح التطبيق
2. اختر "مريض"
3. سجل حساب جديد بالبيانات التالية:
   - الاسم: "أحمد محمد"
   - البريد الإلكتروني: "patient@test.com"
   - كلمة المرور: "123456"
   - رقم الهاتف: "+201234567890"
4. تأكد من نجاح التسجيل والانتقال للوحة التحكم

#### طلب الطوارئ
1. من وحة تحكم المريض، اضغط "طلب طوارئ"
2. تأكد من تحديد الموقع تلقائياً
3. أدخل الأعراض: "ألم في الصدر وضيق في التنفس"
4. اختر مستوى الأولوية: "عالي"
5. تأكد من ظهور قائمة الأطباء المتاحين
6. اختر طبيب واضغط "إرسال طلب الطوارئ"
7. تأكد من نجاح إرسال الطلب والانتقال لشاشة التتبع

#### حالة عدم وجود أطباء متاحين
1. تأكد من أن جميع الأطباء غير متاحين (available = false)
2. حاول إنشاء طلب طوارئ
3. تأكد من ظهور رسالة "لا يوجد أطباء متاحون حالياً"
4. تأكد من تعطيل زر "إرسال طلب الطوارئ"

### 2. اختبار تدفق الطبيب (Doctor Flow)

#### التسجيل والدخول
1. افتح التطبيق
2. اختر "طبيب"
3. سجل حساب جديد بالبيانات التالية:
   - الاسم: "د. سارة أحمد"
   - البريد الإلكتروني: "doctor@test.com"
   - كلمة المرور: "123456"
   - رقم الهاتف: "+201234567891"
   - التخصص: "طب القلب"
   - سنوات الخبرة: "5-10 سنوات"
4. تأكد من الانتقال لشاشة "في انتظار التحقق"

#### وحة تحكم الطبيب (بعد التحقق من الأدمن)
1. سجل دخول كأدمن وحقق الطبيب
2. سجل دخول كطبيب
3. تأكد من ظهور وحة التحكم
4. تأكد من وجود زر التفعيل/التعطيل للإتاحة
5. اختبر تغيير حالة الإتاحة:
   - فعّل الإتاحة → تأكد من ظهور "متاح للطوارئ"
   - عطّل الإتاحة → تأكد من ظهور "غير متاح"

#### استقبال طلبات الطوارئ
1. تأكد من أن الطبيب متاح (available = true)
2. أنشئ طلب طوارئ من حساب مريض
3. تأكد من ظهور الطلب في قائمة "الطلبات المعلقة"
4. اضغط "قبول" على الطلب
5. تأكد من تحديث حالة الطلب إلى "مقبول"

### 3. اختبار تدفق الأدمن (Admin Flow)

#### الدخول
1. افتح التطبيق
2. اختر "أدمن"
3. سجل دخول بالبيانات التالية:
   - البريد الإلكتروني: "admin@test.com"
   - كلمة المرور: "admin123"

#### إدارة الأطباء
1. من وحة تحكم الأدمن، اذهب لتبويب "المستخدمون"
2. اختر تبويب "الأطباء"
3. تأكد من ظهور قائمة الأطباء
4. اضغط على القائمة المنبثقة لأحد الأطباء
5. اختر "عرض ملفات التحقق"
6. تأكد من ظهور نافذة ملفات التحقق
7. إذا كانت هناك شهادات، تأكد من إمكانية عرضها
8. اضغط "موافقة وتحقق" لتحقق الطبيب
9. تأكد من تحديث حالة الطبيب إلى "محقق"

#### إدارة المرضى
1. اختر تبويب "المرضى"
2. تأكد من ظهور قائمة المرضى
3. اختبر عرض تفاصيل المريض
4. اختبر حذف مريض (اختياري)

### 4. اختبار الإشعارات

#### إعداد الإشعارات
1. تأكد من تفعيل الإشعارات في إعدادات الجهاز
2. تأكد من منح التطبيق إذن الإشعارات

#### اختبار إرسال الإشعارات
1. سجل دخول كطبيب وتأكد من الإتاحة
2. من حساب مريض، أنشئ طلب طوارئ
3. تأكد من وصول إشعار للطبيب
4. اضغط على الإشعار وتأكد من فتح التطبيق

### 5. اختبار معالجة الأخطاء

#### أخطاء المصادقة
1. حاول تسجيل الدخول ببريد إلكتروني غير موجود
2. تأكد من ظهور رسالة خطأ واضحة: "المستخدم غير موجود"
3. حاول تسجيل الدخول بكلمة مرور خاطئة
4. تأكد من ظهور رسالة خطأ: "كلمة المرور غير صحيحة"
5. حاول إنشاء حساب ببريد إلكتروني مستخدم
6. تأكد من ظهور رسالة: "البريد الإلكتروني مستخدم بالفعل"

#### أخطاء الشبكة
1. أغلق الإنترنت
2. حاول تسجيل الدخول
3. تأكد من ظهور رسالة خطأ مناسبة
4. أعد تشغيل الإنترنت وحاول مرة أخرى

### 6. اختبار التنقل

#### التنقل بين الشاشات
1. تأكد من عمل جميع الأزرار والروابط
2. تأكد من عدم ظهور شاشات سوداء أو أخطاء "صفحة غير موجودة"
3. اختبر زر "العودة" في جميع الشاشات
4. اختبر التنقل من الإشعارات

## معايير النجاح

### ✅ المريض
- [x] التسجيل والدخول يعمل بنجاح
- [x] طلب الطوارئ يعرض الأطباء المتاحين فقط
- [x] إرسال الطلب ينجح ويصل للطبيب
- [x] تتبع الطلب يعمل في الوقت الفعلي
- [x] رسائل الخطأ واضحة ومفهومة

### ✅ الطبيب
- [x] التسجيل والدخول يعمل بنجاح
- [x] زر التفعيل/التعطيل يعمل
- [x] الطلبات تصل للأطباء المتاحين فقط
- [x] قبول/رفض الطلبات يعمل
- [x] حالة التحقق تظهر بوضوح

### ✅ الأدمن
- [x] الدخول يعمل بنجاح
- [x] عرض قوائم المستخدمين يعمل
- [x] عرض ملفات التحقق يعمل
- [x] تحقق/إلغاء تحقق الأطباء يعمل
- [x] حذف المستخدمين يعمل

### ✅ عام
- [x] التنقل لا يؤدي لشاشات سوداء
- [x] رسائل الخطأ واضحة
- [x] الإشعارات تعمل
- [x] التطبيق مستقر ولا يتعطل

## تقرير الأخطاء

إذا واجهت أي مشاكل أثناء الاختبار، يرجى توثيقها بالتفاصيل التالية:

1. **خطوات إعادة الإنتاج**: كيفية الوصول للخطأ
2. **السلوك المتوقع**: ما كان يجب أن يحدث
3. **السلوك الفعلي**: ما حدث بالفعل
4. **لقطات الشاشة**: إن أمكن
5. **معلومات الجهاز**: نوع الجهاز ونسخة Android/iOS

## ملاحظات مهمة

- تأكد من وجود اتصال إنترنت مستقر أثناء الاختبار
- تأكد من تفعيل خدمات الموقع
- تأكد من منح التطبيق جميع الأذونات المطلوبة
- اختبر على أجهزة مختلفة إن أمكن
- اختبر في ظروف شبكة مختلفة (WiFi, 4G, ضعيف)
